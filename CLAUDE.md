人気占い師監修の、AI占いWEBアプリを作りたいです。

アプリ名は「スピチャ」です。
スピリチュアルチャットの略です。

下記が概要です↓

Googleアカウントで簡単にログインしてもらうか、アプリ独自のアカウントを作成してもらい、お客様にログインしてもらいます。

初回ログイン時には、強制的にプロフィールの登録を必要とさせます。

ユーザーの名前(ニックネーム可)
生年月日
性別
お悩みのカテゴリ(恋愛
片思い
復縁
不倫/浮気
結婚
仕事
家庭問題
金運)
恋愛相談など、お相手がいる場合はお相手の名前(ニックネーム可)
お相手の性別
お相手の生年月日（わからない場合は大体の年齢を選択してもらうようにする）
お悩みの内容(1000文字まで)
（必須項目は、ユーザーの名前
生年月日
性別
お悩みのカテゴリ
お悩みの内容。それ以外は任意。）
必須項目を入力しないと次の画面に進めないようにし、登録を強制します。

プロフィール登録後、最初に表示される画面は、占い師一覧ページ。
通常の占い師や、ユーザーの守護霊と対話し、守護霊からの言葉をユーザーに伝えてくれる占い師など、様々な占い師を用意します。
占い師は後から増やすので、まずは通常の占い師だけここに表示されるようにしてください。
プロフィール登録が済むと、早速登録された内容を基に、お客様への占いの提案文が生成され、お客様へ占い師からメッセージが送られます。

占い師一覧画面では、LINEのトークルーム一覧画面の様に、左側にアイコンがあり、その横に最新のメッセージ履歴が表示されている状態にします。

占い師を選択すると、LINE風のチャット画面が表示されます。

初回の場合でも、既に提案文が占い師から送られてきているはずです。

トーク画面の下の方にLINEの様にテキストボックスを用意します。
テキストボックスには薄い文字で、”占ってほしい内容を指定or追加情報を教えて改めて提案してもらう”と書いておきます。
実際に、テキストボックスはそういった役割にします。送信ボタンもテキストボックスの右に用意してください。

お客様から送信された内容をプロンプトに追加し、改めて提案文を生成します。
プロンプトにはお客様が登録しているプロフィールの内容すべてと、今までの鑑定結果の内容と、お客様から送信された内容のすべてが含まれるようにします。

この時、今回お客様から送信された内容がどれなのかAIにわかりやすいようにし、ちゃんとそれに対しての提案文を生成できるようにします。

テキストボックスの上には、占ってもらうボタンを用意。

占い師からの提案に対して占ってもらいたいと思った場合、このボタンを押せば占いが始まります。

占ったら、鑑定前メッセージ、鑑定結果、鑑定後メッセージの３通が順番にお客様に送られるようにします。

”出力形式:

[GREETING]
(鑑定前メッセージ)

[RESULT]
(鑑定結果)

[AFTER]
(鑑定後メッセージ)”

上記をプロンプトの最後に含め、この形式で出力してもらうようにします。

この１回の出力で、しっかりお客様には３通で送られるように設計してください。

鑑定結果は400文字程度にします。
この時、鑑定結果だけが、最初の20文字以外はぼやけて見えないようにしておきます。

この時、ソースコードを見ても鑑定結果がわかってしまわないように対策してください。

鑑定結果の文章の中央に、”全文を読む”ボタンを用意し、所持ポイントを消費して、ぼやけているのを外し、全文が読めるようにします。

所持ポイントが足りなければ、そのままポイント購入画面に画面遷移し、ポイント追加を促します。
1000ptで、400文字程度の鑑定結果を読めるようにします。
１ポイント１円の単価です。

ちょうど1000pt追加できる課金プランも用意し、まとめてポイントを追加するほどお得になるよう、いくつか課金プランを用意してください。

課金はStripeを使用します。

鑑定結果をお読みいただけた場合は、次の鑑定の提案を生成し、送信します。

お客様からメッセージを送信して新しい提案をしてもらうのは、３回までとします。
鑑定結果を開封したらこの回数はリセットされます。
日付をまたいだ場合もこの回数をリセットします。

つまり、鑑定結果を開封しなくても１日３回まではお客様からメッセージを送信し、新しい提案を受けられるということです。

お客様が一度に送信できるメッセージの文字数は1000文字までとします。

占ってもらっている最中にお客様がブラウザを閉じてしまったとしても、ちゃんとシステム内部で実行されて占い結果が届くようにしたいです。

プロンプトはbrタグなど使わずに、改行がそのまま反映される状態で設定したいです。「"""」クォーターマーク３つで囲んで設定するやり方がいいかもしれません。

占い履歴の閲覧機能が必要でしょう。
占い師とのトークルームの右上などにハンバーガーメニューを用意し、そこにボタンを追加します。
過去の鑑定結果を日付順に閲覧できる機能により、ユーザーは自分の悩みの変化や占い師からのアドバイスを振り返ることができます。

管理者用のダッシュボードが不可欠です。
ユーザー数、課金状況、鑑定回数などの統計データをリアルタイムで確認できる機能により、運営の意思決定をサポートします。
また、キャンペーンやクーポンコードの発行機能、期間限定の割引プランなど、マーケティング施策を柔軟に実施できる仕組みも重要です。
管理者用ページに必要な機能を考えて様々なことを管理できるようにしてください。



全体的なトーンとカラーパレット
スピリチュアルな世界観を表現しつつ、信頼感と安心感を与えることが重要です。
深みのある紫や藍色をメインカラーに、アクセントとしてゴールドや淡いピンクを組み合わせることで、神秘的でありながら柔らかく親しみやすい印象を作り出せます。
背景には微細なグラデーションや星空を思わせる装飾を控えめに配置することで、スピリチュアルな雰囲気を演出できます。
ただし、過度に装飾的にならないよう、清潔感と読みやすさは常に優先すべきです。

占い師一覧ページとチャットUI
LINE風のインターフェースという要件を活かしつつ、より洗練された印象にするため、各占い師のアイコンは円形で統一し、プロフィール写真の周りに微妙な光彩効果や装飾的なフレームを追加することをお勧めします。
メッセージプレビューは簡潔に表示し、未読メッセージがある場合は目立つバッジで知らせます。
チャット画面では、占い師からのメッセージと利用者のメッセージを明確に区別するため、吹き出しの形状や色味に変化をつけ、占い師側のメッセージには特別感を演出する背景パターンやアイコンの装飾を施すとよいでしょう。

鑑定結果の表示演出
鑑定結果が届く際には、特別な体験であることを印象づける演出が効果的です。
画面に鑑定結果カードがフェードインする際、微妙なアニメーションや光の演出を加えることで期待感を高められます。
ぼかし処理された鑑定結果の部分には、「全文を読む」ボタンを中央に配置し、ボタン自体にゴールドのグラデーションや輝きのエフェクトを加えることで、開封したくなる心理を刺激します。ボタンの周囲にポイント消費数を明確に表示し、価値を認識していただくことも重要です。

ポイント購入画面の設計
課金への心理的ハードルを下げるため、ポイント購入画面は明るく前向きな印象にします。各プランをカード形式で並べ、おすすめプランには「お得」や「人気」といったバッジを目立つように配置します。
まとめ買いのメリットを視覚的に理解しやすくするため、通常価格と割引後の価格を並べて表示し、節約できる金額を強調します。
Stripeの決済画面への遷移はスムーズに行い、セキュリティの高さも明示することで安心感を与えます。

全体的なユーザビリティ
モバイルファーストの設計を心がけ、片手での操作がしやすいよう、重要なボタンは画面下部に配置します。
フォントは可読性の高いものを選び、文字サイズも十分に確保します。
プロフィール登録画面では、必須項目と任意項目を色分けやアイコンで明確に区別し、入力エラーは優しいトーンでガイダンスします。
ローディング中は、占いに関連した魅力的なメッセージやアニメーションを表示することで、待ち時間を価値ある体験に変えることができます。
このような方向性で、スピリチュアルな世界観と現代的な使いやすさを両立させたデザインにしてください。

推奨する背景カラーの方向性
メインの背景色としては、深みのある濃紺から紫がかった藍色のグラデーション（例えば#1a1a2eから#16213eの範囲）を基調とすることをお勧めします。
この色域は夜空や宇宙を連想させ、スピリチュアルな雰囲気を自然に醸成します。
完全な黒ではなく、わずかに青みや紫みを含んだ暗色を選ぶことで、重厚感がありながらも圧迫感のない空間を作り出せます。
この濃色の背景に対して、コンテンツエリア（チャット画面やプロフィール入力フォームなど）は少し明るいトーン（#2d2d44や#3a3a52程度）で区切ることで、情報の階層構造を明確にできます。
完全な白背景は避け、わずかに色味のある明るいグレー（#f5f5faなど）を使用することで、目に優しく長時間の利用でも疲れにくいインターフェースを実現できます。

アクセントカラーの設定
ボタンや重要な情報の強調には、ゴールド系（#d4af37や#c9a961）またはローズゴールド（#b76e79）を使用すると、高級感と温かみを同時に表現できます。
特に「占ってもらう」ボタンや「全文を読む」ボタンには、このゴールド系の色を採用し、わずかなグラデーションを加えることで、行動を促す効果が高まります。
また、占い師からのメッセージには淡い紫やラベンダー系（#b8a6d9や#c8b8db）を背景に使用することで、神秘性を保ちながら読みやすさを確保できます。
一方、利用者自身のメッセージには控えめなグレー系を使用することで、対話の主役が占い師であることを視覚的に示すことができます。

実装における注意点
背景に微細なテクスチャやパターン（星のきらめきや幾何学模様など）を追加する場合は、不透明度を10パーセントから15パーセント程度に抑え、主要なコンテンツの視認性を損なわないよう配慮が必要です。
また、ポイント購入画面など、金銭的な取引が発生するページでは、背景をやや明るめにし、情報の透明性と信頼性を視覚的に強調することが望ましいでしょう。
このようなカラー設計により、スピリチュアルな世界観を保ちながら、利用者が安心して長時間利用できるアプリケーションを構築できます。

技術スタック

フロントエンド
フロントエンド開発にはNext.js 14以降（App Router）をReactフレームワークとして採用します。
Next.jsはサーバーサイドレンダリングと静的サイト生成の両方をサポートし、優れたパフォーマンスとSEO最適化を実現します。
開発言語にはTypeScriptを使用し、型安全性を確保することで大規模開発における保守性とコード品質を向上させます。
スタイリングにはTailwind CSSを採用します。
ユーティリティファーストのアプローチにより、一貫したデザインシステムの構築と迅速な開発が可能となります。
スピリチュアルな世界観を表現するカスタムカラーパレットとコンポーネントを、Tailwindの設定ファイルで定義します。
UIコンポーネントライブラリとしてshadcn/uiを使用します。
アクセシブルで高品質なコンポーネントを提供し、チャットインターフェース、モーダル、フォーム要素などの実装を効率化します。
LINE風のチャットUIは、これらのコンポーネントをカスタマイズして構築します。
状態管理にはReact Context APIとZustandを組み合わせて使用します。
グローバルな状態（ユーザー情報、ポイント残高、占い師選択状態など）はZustandで管理し、軽量かつ効率的な状態更新を実現します。

バックエンド・データベース
バックエンドインフラストラクチャとしてSupabaseを採用します。
Supabaseは認証、データベース、ストレージ、リアルタイム機能を統合的に提供するBaaS（Backend as a Service）プラットフォームであり、開発速度と運用効率の両面で優位性があります。
データベースにはSupabaseが提供するPostgreSQLを使用します。
リレーショナルデータベースでありながら、JSONBデータ型により柔軟なスキーマ設計が可能です。
ユーザープロフィール、チャット履歴、鑑定結果、ポイント取引履歴などのテーブルを設計し、適切なインデックスとRow Level Security（RLS）ポリシーを設定することでセキュリティを確保します。
認証機能はSupabase Authを使用します。
Googleアカウントによるソーシャルログインと、メールアドレス・パスワードによる独自アカウント作成の両方をサポートします。
将来的にはApple Sign Inなど追加の認証プロバイダーも容易に統合できます。
セッション管理とトークンのリフレッシュは自動的に処理されます。
リアルタイムチャット機能にはSupabase Realtimeを活用します。
WebSocketベースの双方向通信により、占い師からの新しいメッセージをユーザーに即座に配信します。
PostgreSQLのトリガーとSupabase Realtimeのサブスクリプション機能を組み合わせることで、データベースの変更をリアルタイムでクライアントに反映させることができます。
サーバーサイドロジックが必要な処理については、Supabase Edge Functionsを使用します。これはDeno Deployをベースとしたサーバーレス関数実行環境であり、TypeScriptで記述されます。
AI APIの呼び出し、複雑なビジネスロジックの実行、Webhook処理などに使用します。Edge Functionsは世界中の複数のリージョンにデプロイされ、低レイテンシーな応答を実現します。

AI統合
占い師のAI機能にはGemini2.5Proを使用します。
高度な推論能力と自然な対話能力を持ち、ユーザーの悩みに対して共感的で洞察に富んだ占い結果を生成します。
APIキーはSupabaseのシークレット管理機能を使用して安全に保管し、Edge Functionsからのみアクセス可能とします。
各占い師のキャラクター性を実現するため、占い師ごとに専用のシステムプロンプトを設計します。
プロンプトにはユーザープロフィール情報、過去の鑑定履歴、現在の質問内容を含め、コンテキストを考慮した一貫性のある応答を生成します。
プロンプトの最適化により、APIコストの削減と応答品質の向上を両立させます。
鑑定結果の生成時には、鑑定前メッセージ、鑑定結果本文、鑑定後メッセージの三部構成を指定する出力フォーマットをプロンプトに含めます。
Gemini APIのストリーミング機能を活用することで、長文の生成中もユーザーに進行状況を表示し、体験を向上させることができます。

決済システム
課金機能の実装にはStripeを使用します。
ポイント購入、将来的なサブスクリプションプランの提供に対応します。
Stripe Payment Elementを採用することで、クレジットカード、デビットカード、その他の決済手段に対応した最適化されたチェックアウト体験を提供します。
決済処理はSupabase Edge Functionsを通じてサーバーサイドで実行します。
クライアント側では決済フローの開始と完了のみを処理し、金額や商品情報の改ざんを防止します。Stripe Checkoutまたはカスタムペイメントフローを実装し、日本円での課金に対応します。
Stripe Webhookを設定し、決済の成功、失敗、払い戻しなどのイベントをリアルタイムで受信します。
WebhookハンドラーはSupabase Edge Functionとして実装し、イベントの署名検証を行った後、データベースのポイント残高を更新します。
冪等性を確保するため、各Webhookイベントの処理状態をデータベースに記録します。
テスト環境ではStripeのテストモードを使用し、本番環境への移行前に決済フローを十分に検証します。
Stripe Dashboardを通じて取引履歴、顧客情報、売上分析などを監視し、運営上の意思決定に活用します。

デプロイメント・ホスティング
フロントエンドアプリケーションのデプロイにはVercelを使用します。
Next.jsとの完全な統合により、自動ビルド、プレビューデプロイメント、本番環境への継続的デプロイメントが実現されます。
GitHubリポジトリとの連携により、プルリクエストごとに独立したプレビュー環境が自動生成され、レビュープロセスが効率化されます。
VercelのEdge Networkにより、世界中のユーザーに対して低レイテンシーでアプリケーションを配信します。
画像最適化、自動キャッシング、CDNによる静的アセットの配信など、パフォーマンス最適化機能が標準で提供されます。
環境変数の管理にはVercelの環境変数機能を使用し、開発環境、ステージング環境、本番環境ごとに異なる設定を適用します。
Supabase APIキー、Stripe APIキー、Gemini APIキーなどの機密情報は暗号化されて保存され、ビルド時およびランタイムに安全に注入されます。

開発ツール・ワークフロー
バージョン管理にはGitを使用し、GitHubをリモートリポジトリとして採用します。
ブランチ戦略としてGitHub Flowを採用し、main ブランチは常にデプロイ可能な状態を維持します。
機能開発は個別のフィーチャーブランチで行い、プルリクエストを通じてコードレビューとマージを実施します。
コード品質の維持のため、ESLintとPrettierを設定します。
TypeScriptの厳格な型チェック、Reactのベストプラクティスに基づくルール、アクセシビリティチェックを含む包括的なリンティング設定を適用します。
pre-commit フックによりコミット前の自動フォーマットとリンティングを実施し、一貫したコード品質を確保します。
テスト戦略としては、Jestによるユニットテスト、React Testing Libraryによるコンポーネントテスト、Playwrightによるエンドツーエンドテストを組み合わせます。
特に決済フロー、ポイント消費、鑑定結果の表示など、重要なビジネスロジックについては高いテストカバレッジを維持します。
継続的インテグレーション・継続的デプロイメント（CI/CD）にはGitHub Actionsを使用します。
プルリクエストごとに自動的にテストを実行し、型チェック、リンティング、ビルドの成功を確認します。
main ブランチへのマージ時には自動的にVercelへのデプロイが実行されます。

セキュリティ対策
セキュリティは設計段階から考慮します。
Supabase Row Level Security（RLS）により、データベースレベルでユーザーごとのアクセス制御を実装します。
各ユーザーは自分自身のプロフィール、チャット履歴、鑑定結果のみにアクセスできるよう、適切なポリシーを設定します。
APIエンドポイントへのアクセスには認証トークンを必須とし、Supabase Authが発行するJWTトークンの検証を行います。
レート制限を実装し、不正なAPI呼び出しやDDoS攻撃から保護します。
特にAI API呼び出しやポイント消費を伴うエンドポイントについては、厳格なレート制限を適用します。
鑑定結果のぼかし処理については、クライアント側でCSS filterを適用し、サーバーからは完全な鑑定結果を送信しません。
ポイント消費前は鑑定結果の最初の20文字のみをクライアントに送信し、ポイント消費確認後に完全な結果を取得するフローを実装します。
これによりブラウザの開発者ツールからの不正な閲覧を防止します。
すべての通信はHTTPS/WSS（WebSocket Secure）で暗号化します。
Supabase APIエンドポイント、Stripe API、Gemini APIとの通信はすべてTLS 1.3以上のプロトコルで保護されます。
機密情報をクライアント側のローカルストレージに保存することは避け、必要な情報はメモリまたはhttpOnlyクッキーで管理します。

監視・分析
アプリケーションの健全性とユーザー行動を監視するため、適切な分析ツールを導入します。Vercel Analyticsによりページビュー、Core Web Vitals、地理的分布などの基本的なメトリクスを収集します。
エラートラッキングにはSentryを使用し、フロントエンドおよびEdge Functionsで発生する例外を自動的に収集します。
エラーの発生頻度、影響を受けるユーザー数、スタックトレースなどの情報により、迅速な問題解決が可能となります。
Supabase Dashboardでは、データベースのパフォーマンス、API使用量、認証統計などを監視します。
スロークエリの検出、インデックスの最適化、テーブルサイズの管理などにより、データベースのパフォーマンスを維持します。
ビジネスメトリクスの追跡のため、カスタムイベントログをデータベースに記録します。ユーザー登録数、鑑定回数、ポイント購入額、占い師別の利用統計などを分析し、プロダクトの改善とビジネス戦略の策定に活用します。

開発フェーズとマイルストーン
プロジェクトはMVP（Minimum Viable Product）アプローチに基づき、段階的に開発を進めます。
第一フェーズでは、ユーザー認証、プロフィール登録、基本的なチャット機能、一人の占い師との対話、鑑定結果の表示とぼかし処理、Stripeによるポイント購入機能を実装します。

第二フェーズでは、複数の占い師の追加、履歴閲覧機能、通知機能、管理者ダッシュボードの基本機能を開発します。
第三フェーズでは、高度な分析機能、パフォーマンス最適化、スケーラビリティの改善を実施します。
各フェーズの終了時には、ユーザーテストを実施しフィードバックを収集します。
データ駆動型のアプローチにより、ユーザーの実際の利用パターンと要望に基づいて機能の優先順位を調整し、継続的な改善を行います。

接続したMCPサーバーを自由に使って開発やテストに役立ててください。

接続したMCPサーバー↓

Supabase MCP - データベース連携用
Playwright MCP - ブラウザ自動化テスト用
Chrome DevTools MCP - リアルタイムブラウザデバッグ・パフォーマンス分析用（Google公式2025年9月リリース）
filesystem MCP - ファイルシステムアクセス用
Desktop Commander - デスクトップ操作用
Github MCP - GitHub連携用
Context7 MCP - コンテキスト管理用
serena MCP

supabase MCP token↓
your_supabase_mcp_token

anon public↓
your_supabase_anon_key

service_role↓
your_supabase_service_role_key

プロジェクトURL↓
https://xzmbxvndtmoedyqjtitz.supabase.co

プロジェクトID↓
xzmbxvndtmoedyqjtitz

GITHUB_PERSONAL_ACCESS_TOKEN="your_github_personal_access_token"
Github プロジェクトURL: https://github.com/elmo3159/SpiritualChat.git

GeminiAPIキー: your_gemini_api_key


管理者ページアカウント情報
- メールアドレス: admin@example.com
- パスワード: admin123
- アクセスURL: http://localhost:3000/admin/login
私への回答は日本語で行ってください。

テスト用スピチャアカウント
elmo.123912@gmail.com
pass:sanri3159